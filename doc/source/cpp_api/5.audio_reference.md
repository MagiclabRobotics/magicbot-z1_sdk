---
title: 语音控制服务
createTime: 2025/07/0810:18:56
permalink: /human-z1/audio_reference/
---

# 语音服务

> 提供机器人系统语音服务控制器，通过AudioController可以通过RPC方式实现对机器人的音频进行指令控制和状态获取。

##  接口定义
`AudioController` 是一个封装音频控制功能的 C++ 类，主要用于音频播放控制、TTS 播放、音量设置与查询等场景。

### AudioController

<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 20%; text-align: center;"><strong>项目</strong></th>
      <th style="width: 60%; text-align: center;"><strong>内容</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>函数名</td>
      <td>AudioController</td>
    </tr>
    <tr>
      <td>函数声明</td>
      <td><code>AudioController();</code></td>
    </tr>
    <tr>
      <td>功能概述</td>
      <td>初始化音频控制器对象，构造内部状态，分配资源等。</td>
    </tr>
    <tr>
      <td>备注</td>
      <td>构造内部状态。</td>
    </tr>
  </tbody>
</table>

### ~AudioController


<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 20%; text-align: center;"><strong>项目</strong></th>
      <th style="width: 60%; text-align: center;"><strong>内容</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>函数名</td>
      <td>~AudioController</td>
    </tr>
    <tr>
      <td>函数声明</td>
      <td><code>~AudioController();</code></td>
    </tr>
    <tr>
      <td>功能概述</td>
      <td>释放音频控制器资源，确保停止播放并清理底层资源。</td>
    </tr>
    <tr>
      <td>备注</td>
      <td>确保资源安全释放。</td>
    </tr>
  </tbody>
</table>

### Initialize

<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 20%; text-align: center;"><strong>项目</strong></th>
      <th style="width: 60%; text-align: center;"><strong>内容</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>函数名</td>
      <td>Initialize</td>
    </tr>
    <tr>
      <td>函数声明</td>
      <td><code>bool Initialize();</code></td>
    </tr>
    <tr>
      <td>功能概述</td>
      <td>初始化音频控制模块，准备播放资源与设备。</td>
    </tr>
    <tr>
      <td>返回值</td>
      <td><code>true</code> 表示成功，<code>false</code> 表示失败。</td>
    </tr>
    <tr>
      <td>备注</td>
      <td>与 <code>Shutdown()</code> 配对使用。</td>
    </tr>
  </tbody>
</table>

### Shutdown
<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 20%; text-align: center;"><strong>项目</strong></th>
      <th style="width: 60%; text-align: center;"><strong>内容</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>函数名</td>
      <td>Shutdown</td>
    </tr>
    <tr>
      <td>函数声明</td>
      <td><code>void Shutdown();</code></td>
    </tr>
    <tr>
      <td>功能概述</td>
      <td>关闭音频控制器并释放资源。</td>
    </tr>
    <tr>
      <td>备注</td>
      <td>确保在销毁前调用。</td>
    </tr>
  </tbody>
</table>

### Play
<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 20%; text-align: center;"><strong>项目</strong></th>
      <th style="width: 60%; text-align: center;"><strong>内容</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>函数名</td>
      <td>Play</td>
    </tr>
    <tr>
      <td>函数声明</td>
      <td><code>Status Play(const TtsCommand&amp; cmd);</code></td>
    </tr>
    <tr>
      <td>功能概述</td>
      <td>播放 TTS（文本转语音）语音命令。</td>
    </tr>
    <tr>
      <td>参数说明</td>
      <td><code>cmd</code>：TTS 命令，包含文本、语速、语调等。</td>
    </tr>
    <tr>
      <td>返回值</td>
      <td><code>Status::OK</code> 表示成功，其他为失败状态。</td>
    </tr>
    <tr>
      <td>备注</td>
      <td>阻塞接口，调用前需确保已初始化模块。</td>
    </tr>
  </tbody>
</table>

### Stop
<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 20%; text-align: center;"><strong>项目</strong></th>
      <th style="width: 60%; text-align: center;"><strong>内容</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>函数名</td>
      <td>Stop</td>
    </tr>
    <tr>
      <td>函数声明</td>
      <td><code>Status Stop();</code></td>
    </tr>
    <tr>
      <td>功能概述</td>
      <td>停止当前音频播放。</td>
    </tr>
    <tr>
      <td>返回值</td>
      <td><code>Status::OK</code> 表示成功，其他为失败状态。</td>
    </tr>
    <tr>
      <td>备注</td>
      <td>阻塞接口，通常用于中断当前语音。</td>
    </tr>
  </tbody>
</table>

### SetVolume
<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 20%; text-align: center;"><strong>项目</strong></th>
      <th style="width: 60%; text-align: center;"><strong>内容</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>函数名</td>
      <td>SetVolume</td>
    </tr>
    <tr>
      <td>函数声明</td>
      <td><code>Status SetVolume(int volume);</code></td>
    </tr>
    <tr>
      <td>功能概述</td>
      <td>设置音频输出的音量。</td>
    </tr>
    <tr>
      <td>参数说明</td>
      <td><code>volume</code>：音量值，通常范围为 0~100。</td>
    </tr>
    <tr>
      <td>返回值</td>
      <td><code>Status::OK</code> 表示成功，其他为失败状态。</td>
    </tr>
    <tr>
      <td>备注</td>
      <td>阻塞接口，设置后立即生效。</td>
    </tr>
  </tbody>
</table>

### GetVolume
<table style="width: 100%; table-layout: fixed; border-collapse: collapse; text-align: left;">
  <thead>
    <tr>
      <th style="width: 20%; text-align: center;"><strong>项目</strong></th>
      <th style="width: 60%; text-align: center;"><strong>内容</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>函数名</td>
      <td>GetVolume</td>
    </tr>
    <tr>
      <td>函数声明</td>
      <td><code>Status GetVolume(int&amp; volume);</code></td>
    </tr>
    <tr>
      <td>功能概述</td>
      <td>获取当前音频输出音量。</td>
    </tr>
    <tr>
      <td>参数说明</td>
      <td><code>volume</code>：通过引用返回当前音量值。</td>
    </tr>
    <tr>
      <td>返回值</td>
      <td><code>Status::OK</code> 表示成功，其他为失败状态。</td>
    </tr>
    <tr>
      <td>备注</td>
      <td>阻塞接口，返回值需检查后再使用 <code>volume</code>。</td>
    </tr>
  </tbody>
</table>

##  类型定义

### `TtsPriority` — TTS 播报优先级等级

用于控制不同 TTS 任务之间的中断行为。优先级越高的任务将中断当前低优先级任务的播放。

<table style="width: 100%; table-layout: fixed; border-collapse: collapse;">
  <thead>
    <tr>
      <th style="width: 40%; text-align: center;"><strong>枚举值</strong></th>
      <th style="width: 60%; text-align: center;"><strong>描述</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left;"><code>TtsPriority::HIGH</code></td>
      <td style="text-align: left;">最高优先级，例如：低电告警、紧急提醒</td>
    </tr>
    <tr>
      <td style="text-align: left;"><code>TtsPriority::MIDDLE</code></td>
      <td style="text-align: left;">中优先级，例如：系统提示、状态播报</td>
    </tr>
    <tr>
      <td style="text-align: left;"><code>TtsPriority::LOW</code></td>
      <td style="text-align: left;">最低优先级，例如：日常语音对话、背景播报</td>
    </tr>
  </tbody>
</table>

---

### `TtsMode` — 同一优先级下的任务调度策略

用于细化控制在相同优先级条件下多个 TTS 任务的播放顺序和清除逻辑。

<table style="width: 100%; table-layout: fixed; border-collapse: collapse;">
  <thead>
    <tr>
      <th style="width: 40%; text-align: center;"><strong>枚举值</strong></th>
      <th style="width: 60%; text-align: center;"><strong>描述</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left;"><code>TtsMode::CLEARTOP</code></td>
      <td style="text-align: left;">清空当前优先级所有任务（包括正在播放和等待队列），立即播放本次请求</td>
    </tr>
    <tr>
      <td style="text-align: left;"><code>TtsMode::ADD</code></td>
      <td style="text-align: left;">将本次请求追加到当前优先级队列尾部，顺序播放（不打断当前播放）</td>
    </tr>
    <tr>
      <td style="text-align: left;"><code>TtsMode::CLEARBUFFER</code></td>
      <td style="text-align: left;">清空队列中未播放的请求，保留当前播放，之后播放本次请求</td>
    </tr>
  </tbody>
</table>

---

## 结构体定义

### `TtsCommand` — TTS 播放命令结构体

描述一次 TTS 播放请求的完整信息，支持设置唯一标识、文本内容、优先级控制以及同优先级下的调度模式。

<table style="width: 100%; table-layout: fixed; border-collapse: collapse;">
  <thead>
    <tr>
      <th style="width: 20%; text-align: center;"><strong>字段名</strong></th>
      <th style="width: 30%; text-align: center;"><strong>类型</strong></th>
      <th style="width: 50%; text-align: center;"><strong>描述</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left;"><code>id</code></td>
      <td style="text-align: center;"><code>std::string</code></td>
      <td style="text-align: left;">TTS 任务唯一 ID，例如 <code>"id_01"</code>，用于追踪播放状态</td>
    </tr>
    <tr>
      <td style="text-align: left;"><code>content</code></td>
      <td style="text-align: center;"><code>std::string</code></td>
      <td style="text-align: left;">要播放的文本内容，例如 <code>"你好，欢迎使用智能语音系统。"</code></td>
    </tr>
    <tr>
      <td style="text-align: left;"><code>priority</code></td>
      <td style="text-align: center;"><code>TtsPriority</code></td>
      <td style="text-align: left;">播报优先级，控制是否中断正在播放的低优先级语音</td>
    </tr>
    <tr>
      <td style="text-align: left;"><code>mode</code></td>
      <td style="text-align: center;"><code>TtsMode</code></td>
      <td style="text-align: left;">同优先级下的调度策略，控制任务是否追加、覆盖等</td>
    </tr>
  </tbody>
</table>